<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Techniques de traitement des sources de données usuelles avec <code>Python</code></title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Roland Donat" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="https://roland-donat.github.io/ubs/Charte_graphique/IUT/ubs_iut_vannes.css" />
<link rel="stylesheet" type="text/css" href="https://roland-donat.github.io/ubs-lpsdm-qualite-donnees/custom.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Techniques de traitement des sources de données usuelles avec <code>Python</code></h1>
<div id="table-of-contents">
<h2>Table des matières</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgee8a58c">1. Objectifs</a></li>
<li><a href="#orgd9bff68">2. Environnement de travail</a></li>
<li><a href="#org07cbbe1">3. Fichiers tabulaires</a>
<ul>
<li><a href="#orgaf47e00">3.1. Format CSV</a></li>
<li><a href="#org9e55da8">3.2. Format <code>xlsx</code></a></li>
</ul>
</li>
<li><a href="#org6fc9b09">4. Format JSON</a></li>
<li><a href="#orge18fa15">5. Format YAML</a></li>
<li><a href="#org858b214">6. Format XML</a></li>
<li><a href="#org8bde166">7. <i>Web scraping</i></a>
<ul>
<li><a href="#org88a4883">7.1. Définition</a></li>
<li><a href="#orgfa213e9">7.2. Technique de <i>scraping</i> avec <code>Python</code></a></li>
<li><a href="#org06b8056">7.3. Exemple</a></li>
</ul>
</li>
</ul>
</div>
</div>





<p width="100%" alt="comics">
<img src="https://imgs.xkcd.com/comics/convincing.png" alt="comics" width="100%" />
<a href="https://xkcd.com/833/">Source de l'image</a>
</p>

<div id="outline-container-orgee8a58c" class="outline-2">
<h2 id="orgee8a58c"><span class="section-number-2">1</span> Objectifs</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li>Donner un aperçu des principaux formats de données usuels (hors bases de données).</li>
<li>Présenter les librairies <code>Python</code> permettant de traiter ces différents formats.</li>
<li>Présenter le concept de <i>web scraping</i>.</li>
</ol>
</div>
</div>

<div id="outline-container-orgd9bff68" class="outline-2">
<h2 id="orgd9bff68"><span class="section-number-2">2</span> Environnement de travail</h2>
<div class="outline-text-2" id="text-2">
<p>
Dans cette session, nous allons travailler sur <a href="https://deepnote.com/">Deepnote</a>. <a href="https://deepnote.com/">Deepnote</a> est une plateforme de
développement collaborative en ligne reposant sur l'édition de <i>notebooks</i> (exactement comme
<a href="https://colab.research.google.com/">Google Colab</a>.
</p>

<p>
Avant de débuter le travail, veuillez à :
</p>
<ul class="org-ul">
<li>vous inscrire sur <a href="https://deepnote.com/">Deepnote</a> ;</li>
<li>créer un nouveau <i>notebook</i> que vous dédierez à cette séance ;</li>
<li>prendre rapidement vos marques avec l'interface <a href="https://deepnote.com/">Deepnote</a>.</li>
</ul>
</div>
</div>

<div id="outline-container-org07cbbe1" class="outline-2">
<h2 id="org07cbbe1"><span class="section-number-2">3</span> Fichiers tabulaires</h2>
<div class="outline-text-2" id="text-3">
<p>
Un fichier au format dit "tabulaire" est tout simplement un fichier dont les données peuvent se
structurer sous la forme d'un tableau à double entrées.
</p>

<p>
Le format tabulaire le plus utilisé est le format CSV (<i>Comma Separated Values</i>). Mais, d'autres
  formats plus complexes existent comme le format Excel (<code>xlsx</code>) ou encore le format LibreOffice
  (ODS, <i>Open Document Spreadsheet</i>).
#+end_block-definition
</p>
</div>

<div id="outline-container-orgaf47e00" class="outline-3">
<h3 id="orgaf47e00"><span class="section-number-3">3.1</span> Format CSV</h3>
<div class="outline-text-3" id="text-3-1">
<p>
<b>Caractéristiques :</b>
</p>
<ul class="org-ul">
<li>Format texte, i.e. lisible et éditable avec un éditeur de texte classique.</li>
<li>Données séparées par un caractère de séparation (par défaut la virgule).</li>
</ul>

<p>
<b>Traitements <code>Python</code> :</b>
</p>
<ul class="org-ul">
<li>Utilisation de la librairie <code>Pandas</code>.</li>
<li>Lecture des données avec la fonction <code>read_csv</code>.</li>
<li>Écriture des données avec la méthode <code>to_csv</code>.</li>
</ul>

<p>
<b>Exemple :</b>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> pandas <span style="color: #F0DFAF; font-weight: bold;">as</span> pd

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Lecture</span>
<span style="color: #DFAF8F;">data_csv_path</span> = <span style="color: #CC9393;">"https://roland-donat.github.io/ubs-lpsdm-qualite-donnees/2021-2022/datatype/data/stadiums.csv"</span>
<span style="color: #DFAF8F;">data_csv</span> = pd.read_csv(data_csv_path)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Modification</span>
<span style="color: #DFAF8F;">data_csv</span> = data_csv.drop(columns=[<span style="color: #CC9393;">"Team"</span>])
data_csv.rename(columns={<span style="color: #CC9393;">"FDCOUK"</span>: <span style="color: #CC9393;">"Team ID"</span>}, inplace=<span style="color: #BFEBBF;">True</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#201;criture</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">index=False permet de ne pas sauvegarder l'index (nom des ligne)</span>
data_csv.to_csv(<span style="color: #CC9393;">"stadiums_new.csv"</span>, index=<span style="color: #BFEBBF;">False</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e55da8" class="outline-3">
<h3 id="org9e55da8"><span class="section-number-3">3.2</span> Format <code>xlsx</code></h3>
<div class="outline-text-3" id="text-3-2">
<p>
<b>Caractéristiques :</b>
</p>
<ul class="org-ul">
<li>Format natif Microsoft Excel, i.e. lisible et éditable avec les principaux tableurs (Excel,
LibreOffice, Google Sheets, etc.)</li>
<li>Format contenant, en plus des données, des informations sur les types des valeurs (nombre, date,
chaîne) et de la mise en forme visuelle.</li>
<li>En pratique le format <code>xslx</code> s'appuie sur le format <code>XML</code>.</li>
</ul>

<p>
<b>Traitements <code>Python</code> :</b>
</p>
<ul class="org-ul">
<li>Utilisation de la librairie <code>Pandas</code>.
<ul class="org-ul">
<li>lecture des données avec la fonction <code>read_excel</code> ;</li>
<li>écriture des données avec la méthode <code>to_excel</code>.</li>
</ul></li>
<li>La librairie <code>openpyxl</code> doit être installée (<code>!pip install openpyxl</code>) pour ouvrir un fichier
<code>xlsx</code> avec <code>Pandas</code>.</li>
<li>La librairie <code>xlrd</code> doit être installée (<code>!pip install xlrd</code>) pour ouvrir un fichier
<code>xls</code> (ancien format Excel) avec <code>Pandas</code>.</li>
</ul>

<p>
<b>Exemple 1 : lecture/écriture basique</b>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> pandas <span style="color: #F0DFAF; font-weight: bold;">as</span> pd

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Lecture</span>
<span style="color: #DFAF8F;">data_xlsx_path</span> = <span style="color: #CC9393;">"https://roland-donat.github.io/ubs-lpsdm-qualite-donnees/2021-2022/datatype/data/myco.xlsx"</span>
<span style="color: #DFAF8F;">data_xlsx</span> = pd.read_excel(data_xlsx_path)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Nettoyage</span>
data_xlsx.drop(columns=[col <span style="color: #F0DFAF; font-weight: bold;">for</span> col <span style="color: #F0DFAF; font-weight: bold;">in</span> data_xlsx.columns \
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #F0DFAF; font-weight: bold;">if</span> col.startswith(<span style="color: #CC9393;">"Unnamed"</span>)], inplace=<span style="color: #BFEBBF;">True</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#201;criture</span>
data_xlsx.to_excel(<span style="color: #CC9393;">"myco_template.xlsx"</span>, index=<span style="color: #BFEBBF;">False</span>)  
</pre>
</div>

<p>
<b>Exemple 2 : lecture de tous les onglets du fichier</b>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> pandas <span style="color: #F0DFAF; font-weight: bold;">as</span> pd

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Lecture</span>
<span style="color: #DFAF8F;">data_xlsx_path</span> = <span style="color: #CC9393;">"https://roland-donat.github.io/ubs-lpsdm-qualite-donnees/2021-2022/datatype/data/myco.xlsx"</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Le r&#233;sultat est un dictionnaire de DataFrames (un DataFrame par onglet)</span>
<span style="color: #DFAF8F;">data_xlsx_all</span> = pd.read_excel(data_xlsx_path, sheet_name=<span style="color: #BFEBBF;">None</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Acc&#232;s &#224; l'onglet "Template"</span>
<span style="color: #DFAF8F;">data_xlsx_template</span> = data_xlsx_all[<span style="color: #CC9393;">"Template"</span>]
data_xlsx_template.drop(columns=[col <span style="color: #F0DFAF; font-weight: bold;">for</span> col <span style="color: #F0DFAF; font-weight: bold;">in</span> data_xlsx_template.columns \
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span><span style="color: #F0DFAF; font-weight: bold;">if</span> col.startswith(<span style="color: #CC9393;">"Unnamed"</span>)], inplace=<span style="color: #BFEBBF;">True</span>)
</pre>
</div>

<p>
<b>Exemple 2 (suite): Écriture dans plusieurs onglets</b>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">with</span> pd.ExcelWriter(<span style="color: #CC9393;">'myco_stadiums.xlsx'</span>) <span style="color: #F0DFAF; font-weight: bold;">as</span> writer:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   data_xlsx_template.to_excel(writer, sheet_name=<span style="color: #CC9393;">'myco'</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   data_csv.to_excel(writer, sheet_name=<span style="color: #CC9393;">'stadiums'</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6fc9b09" class="outline-2">
<h2 id="org6fc9b09"><span class="section-number-2">4</span> Format JSON</h2>
<div class="outline-text-2" id="text-4">
<p>
<b>Caractéristiques :</b>
</p>
<ul class="org-ul">
<li>Le format JSON (<i>JavaScript Object Notation</i>) est un format d'échange de données dont la syntaxe
s'inspire des objets du langage <code>JavaScript</code>.</li>
<li>Sa simplicité et son expressivité ont fait de JSON un des standard d'échange de données les plus
utilisés à l'heure actuelle.</li>
<li>Le format JSON peut représenter des nombres, des booléens, des chaînes, la valeur <code>null</code>, des
séquences de valeurs ordonnées, des objets, etc.</li>
<li>Le format s'articule autour de deux structures de données élémentaires :
<ul class="org-ul">
<li>les collections de paires clé/valeur, très similaires aux dictionnaires <code>Python</code> ;</li>
<li>les liste ordonnée de valeurs, très similaires aux listes <code>Python</code>.</li>
</ul></li>
</ul>

<p>
<b>Exemple de données JSON :</b>
</p>
<div class="org-src-container">
<pre class="src src-python">{
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"data"</span>: [
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   {
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"name"</span>: <span style="color: #CC9393;">"Banane"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"price"</span>: 5.99,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"code"</span>: 77
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   },
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   {
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"name"</span>: <span style="color: #CC9393;">"Pomme"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"price"</span>: 2.99,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"code"</span>: 99
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   },
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   {
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"name"</span>: <span style="color: #CC9393;">"Poire"</span>,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"price"</span>: 7.99,
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> <span style="color: #CC9393;">"code"</span>: 170
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   }
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> ]
}
</pre>
</div>

<p>
<b>Traitements <code>Python</code> :</b>
</p>
<ul class="org-ul">
<li>Utilisation du module <code>json</code>.
<ul class="org-ul">
<li>lecture des données avec la fonction <code>load</code> ;</li>
<li>écriture des données avec la fonction <code>dump</code>.</li>
</ul></li>
<li>Manipulation des données :
<ul class="org-ul">
<li>sous forme de dictionnaire ;</li>
<li>avec <code>Pandas</code> si les données sont compatibles avec le format tabulaire.</li>
</ul></li>
</ul>

<p>
<b>Exemple :</b>
</p>
<ul class="org-ul">
<li>Télécharger le fichier <a href="https://roland-donat.github.io/ubs-lpsdm-qualite-donnees/2021-2022/datatype/data/station_status.json">station_status.json</a> sur votre poste.</li>
<li>Importer le fichier par glisser-déposer dans votre environnement Deepnote.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> json
<span style="color: #F0DFAF; font-weight: bold;">import</span> pandas <span style="color: #F0DFAF; font-weight: bold;">as</span> pd

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Lecture des donn&#233;es sous la forme d'un dictionnaire</span>
<span style="color: #DFAF8F;">data_json_path</span> = <span style="color: #CC9393;">"station_status.json"</span>
<span style="color: #F0DFAF; font-weight: bold;">with</span> <span style="color: #DCDCCC; font-weight: bold;">open</span>(data_json_path, <span style="color: #CC9393;">'r'</span>) <span style="color: #F0DFAF; font-weight: bold;">as</span> json_file:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">data_json</span> = json.load(json_file)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Conversion de la partie `data/stations` en DataFrame pour traitements</span>
<span style="color: #DFAF8F;">stations_df</span> = pd.DataFrame(data_json[<span style="color: #CC9393;">"data"</span>][<span style="color: #CC9393;">"stations"</span>])

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Conversion de l'instant de mise &#224; jour (en secondes) en date </span>
<span style="color: #DFAF8F;">stations_df</span>[<span style="color: #CC9393;">"last_reported_dt"</span>] = \
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   pd.to_datetime(stations_df[<span style="color: #CC9393;">"last_reported"</span>], unit=<span style="color: #CC9393;">"s"</span>)\
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DCDCCC; background-color: #4F4F4F;"> </span> .astype(<span style="color: #DCDCCC; font-weight: bold;">str</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Mise &#224; jour du dictionnaire de donn&#233;es initial avec les nouvelles donn&#233;es</span>
data_json[<span style="color: #CC9393;">"data"</span>][<span style="color: #CC9393;">"stations"</span>] = stations_df.to_dict(<span style="color: #CC9393;">"records"</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">&#201;criture du dictionnaire mis &#224; jour sous forme de fichier json</span>
<span style="color: #DFAF8F;">data_json_bis_path</span> = <span style="color: #CC9393;">"station_status_bis.json"</span>
<span style="color: #F0DFAF; font-weight: bold;">with</span> <span style="color: #DCDCCC; font-weight: bold;">open</span>(data_json_bis_path, <span style="color: #CC9393;">'w'</span>) <span style="color: #F0DFAF; font-weight: bold;">as</span> json_file:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   json.dump(data_json, json_file)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge18fa15" class="outline-2">
<h2 id="orge18fa15"><span class="section-number-2">5</span> Format YAML</h2>
<div class="outline-text-2" id="text-5">
<p>
<b>Caractéristiques :</b>
</p>

<ul class="org-ul">
<li>YAML (<i>YAML Ain't Markup Language</i>) est un format de représentation de données.</li>
<li>YAML s'inspire des concepts d'autres formats comme JSON ou XML.</li>
<li>L'objectif du format est de représenter des informations complexes en conservant une certaine
lisibilité.</li>
<li>Le format JSON est inclus dans le format YAML, i.e. tout fichier JSON peut être converti en
fichier YAML sans perte d'information, l'inverse n'est pas possible.</li>
<li>Sa simplicité et sa lisibilité font de YAML le standard actuel pour l'écriture des fichiers de
configuration.</li>
<li>La hiérarchie de la structure de données est assurée par une indentation homogène (comme en
<code>Python</code>)</li>
</ul>

<p>
<b>Exemple de données YAML :</b>
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #DFAF8F;">data</span>:
  - <span style="color: #DFAF8F;">name</span>: Banane
    <span style="color: #DFAF8F;">price</span>: 5.99
    <span style="color: #DFAF8F;">code</span>: 77
  - <span style="color: #DFAF8F;">name</span>: Pomme
    <span style="color: #DFAF8F;">price</span>: 2.99
    <span style="color: #DFAF8F;">code</span>: 99
  - <span style="color: #DFAF8F;">name</span>: Poire
    <span style="color: #DFAF8F;">price</span>: 7.99
    <span style="color: #DFAF8F;">code</span>: 170
</pre>
</div>

<p>
<b>Traitements <code>Python</code> :</b>
</p>
<ul class="org-ul">
<li>Utilisation du module <code>pyyaml</code> (<code>!pip install pyyaml</code>).
<ul class="org-ul">
<li>lecture des données avec la fonction <code>load</code> ;</li>
<li>écriture des données avec la fonction <code>dump</code>.</li>
</ul></li>
<li>Manipulation des données :
<ul class="org-ul">
<li>sous forme de dictionnaire ;</li>
<li>avec <code>Pandas</code> si les données sont compatibles avec le format tabulaire.</li>
</ul></li>
</ul>

<p>
<b>Exemple :</b>
</p>
<ul class="org-ul">
<li>Télécharger le fichier <a href="https://roland-donat.github.io/ubs-lpsdm-qualite-donnees/2021-2022/datatype/data/quiz.yaml">quiz.yaml</a> sur votre poste.</li>
<li>Importer le fichier par glisser-déposer dans votre environnement Deepnote.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">import</span> yaml
<span style="color: #F0DFAF; font-weight: bold;">import</span> pandas <span style="color: #F0DFAF; font-weight: bold;">as</span> pd

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Lecture des donn&#233;es sous la forme d'un dictionnaire</span>
<span style="color: #DFAF8F;">data_yaml_path</span> = <span style="color: #CC9393;">"quiz.yaml"</span>
<span style="color: #F0DFAF; font-weight: bold;">with</span> <span style="color: #DCDCCC; font-weight: bold;">open</span>(data_yaml_path, <span style="color: #CC9393;">'r'</span>) <span style="color: #F0DFAF; font-weight: bold;">as</span> yaml_file:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">data_yaml</span> = yaml.load(yaml_file, Loader=yaml.SafeLoader)
</pre>
</div>
</div>
</div>

<div id="outline-container-org858b214" class="outline-2">
<h2 id="org858b214"><span class="section-number-2">6</span> Format XML</h2>
<div class="outline-text-2" id="text-6">
<p>
<b>Caractéristiques :</b>
</p>
<ul class="org-ul">
<li>Le langage XML (<i>eXtended Markup Language</i>) est un format général de documents orienté texte.</li>
<li>Le langage XML est un langage orienté texte et formé de balises permettant d'organiser des données de manière structurée.</li>
<li>Le format XML est utilisé pour le stockage de document ainsi que pour la transmission de données
entre applications (bien que supplanté par le format JSON aujourd'hui).</li>
<li>Le langage XML dérive de SGML (<i>Standard Generalized Markup Language</i>) et de HTML (<i>HyperText
Markup Language</i>).</li>
</ul>

<p>
<b>Exemple de données XML :</b>
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #93E0E3;">pdv_liste</span>&gt;
  &lt;<span style="color: #93E0E3;">pdv</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"1000001"</span> <span style="color: #DFAF8F;">latitude</span>=<span style="color: #CC9393;">"4620114"</span> <span style="color: #DFAF8F;">longitude</span>=<span style="color: #CC9393;">"519791"</span> <span style="color: #DFAF8F;">cp</span>=<span style="color: #CC9393;">"01000"</span> <span style="color: #DFAF8F;">pop</span>=<span style="color: #CC9393;">"R"</span>&gt;
    &lt;<span style="color: #93E0E3;">adresse</span>&gt;596 AVENUE DE TREVOUX&lt;/<span style="color: #93E0E3;">adresse</span>&gt;
    &lt;<span style="color: #93E0E3;">ville</span>&gt;SAINT-DENIS-L&#232;S-BOURG&lt;/<span style="color: #93E0E3;">ville</span>&gt;
    &lt;<span style="color: #93E0E3;">services</span>&gt;
      &lt;<span style="color: #93E0E3;">service</span>&gt;Station de gonflage&lt;/<span style="color: #93E0E3;">service</span>&gt;
      &lt;<span style="color: #93E0E3;">service</span>&gt;Vente de gaz domestique (Butane, Propane)&lt;/<span style="color: #93E0E3;">service</span>&gt;
      &lt;<span style="color: #93E0E3;">service</span>&gt;DAB (Distributeur automatique de billets)&lt;/<span style="color: #93E0E3;">service</span>&gt;
    &lt;/<span style="color: #93E0E3;">services</span>&gt;
    &lt;<span style="color: #93E0E3;">prix</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"Gazole"</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"1"</span> <span style="color: #DFAF8F;">maj</span>=<span style="color: #CC9393;">"2021-11-19T10:00:41"</span> <span style="color: #DFAF8F;">valeur</span>=<span style="color: #CC9393;">"1524"</span>/&gt;
    &lt;<span style="color: #93E0E3;">prix</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"SP95"</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"2"</span> <span style="color: #DFAF8F;">maj</span>=<span style="color: #CC9393;">"2021-11-19T10:00:41"</span> <span style="color: #DFAF8F;">valeur</span>=<span style="color: #CC9393;">"1616"</span>/&gt;
    &lt;<span style="color: #93E0E3;">prix</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"SP98"</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"6"</span> <span style="color: #DFAF8F;">maj</span>=<span style="color: #CC9393;">"2021-11-19T10:00:41"</span> <span style="color: #DFAF8F;">valeur</span>=<span style="color: #CC9393;">"1660"</span>/&gt;
    &lt;<span style="color: #93E0E3;">rupture</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"4"</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"GPLc"</span> <span style="color: #DFAF8F;">debut</span>=<span style="color: #CC9393;">"2017-09-16T09:50:23"</span> <span style="color: #DFAF8F;">fin</span>=<span style="color: #CC9393;">""</span>/&gt;
    &lt;<span style="color: #93E0E3;">rupture</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"3"</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"E85"</span> <span style="color: #DFAF8F;">debut</span>=<span style="color: #CC9393;">"2017-09-16T09:50:23"</span> <span style="color: #DFAF8F;">fin</span>=<span style="color: #CC9393;">""</span>/&gt;
    &lt;<span style="color: #93E0E3;">rupture</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"5"</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"E10"</span> <span style="color: #DFAF8F;">debut</span>=<span style="color: #CC9393;">"2018-12-13T09:49:49"</span> <span style="color: #DFAF8F;">fin</span>=<span style="color: #CC9393;">""</span>/&gt;
  &lt;/<span style="color: #93E0E3;">pdv</span>&gt;
  &lt;<span style="color: #93E0E3;">pdv</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"1000002"</span> <span style="color: #DFAF8F;">latitude</span>=<span style="color: #CC9393;">"4621842"</span> <span style="color: #DFAF8F;">longitude</span>=<span style="color: #CC9393;">"522767"</span> <span style="color: #DFAF8F;">cp</span>=<span style="color: #CC9393;">"01000"</span> <span style="color: #DFAF8F;">pop</span>=<span style="color: #CC9393;">"R"</span>&gt;
    &lt;<span style="color: #93E0E3;">adresse</span>&gt;16 Avenue de Marboz&lt;/<span style="color: #93E0E3;">adresse</span>&gt;
    &lt;<span style="color: #93E0E3;">ville</span>&gt;BOURG-EN-BRESSE&lt;/<span style="color: #93E0E3;">ville</span>&gt;
    &lt;<span style="color: #93E0E3;">services</span>&gt;
      &lt;<span style="color: #93E0E3;">service</span>&gt;Vente de gaz domestique (Butane, Propane)&lt;/<span style="color: #93E0E3;">service</span>&gt;
      &lt;<span style="color: #93E0E3;">service</span>&gt;DAB (Distributeur automatique de billets)&lt;/<span style="color: #93E0E3;">service</span>&gt;
    &lt;/<span style="color: #93E0E3;">services</span>&gt;
    &lt;<span style="color: #93E0E3;">prix</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"Gazole"</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"1"</span> <span style="color: #DFAF8F;">maj</span>=<span style="color: #CC9393;">"2021-11-18T15:00:57"</span> <span style="color: #DFAF8F;">valeur</span>=<span style="color: #CC9393;">"1527"</span>/&gt;
    &lt;<span style="color: #93E0E3;">prix</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"SP95"</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"2"</span> <span style="color: #DFAF8F;">maj</span>=<span style="color: #CC9393;">"2021-11-18T15:00:58"</span> <span style="color: #DFAF8F;">valeur</span>=<span style="color: #CC9393;">"1631"</span>/&gt;
    &lt;<span style="color: #93E0E3;">prix</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"SP98"</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"6"</span> <span style="color: #DFAF8F;">maj</span>=<span style="color: #CC9393;">"2021-11-18T15:00:58"</span> <span style="color: #DFAF8F;">valeur</span>=<span style="color: #CC9393;">"1670"</span>/&gt;
    &lt;<span style="color: #93E0E3;">rupture</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"3"</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"E85"</span> <span style="color: #DFAF8F;">debut</span>=<span style="color: #CC9393;">"2017-09-07T11:05:59"</span> <span style="color: #DFAF8F;">fin</span>=<span style="color: #CC9393;">""</span>/&gt;
    &lt;<span style="color: #93E0E3;">rupture</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"4"</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"GPLc"</span> <span style="color: #DFAF8F;">debut</span>=<span style="color: #CC9393;">"2017-09-07T11:05:59"</span> <span style="color: #DFAF8F;">fin</span>=<span style="color: #CC9393;">""</span>/&gt;
    &lt;<span style="color: #93E0E3;">rupture</span> <span style="color: #DFAF8F;">id</span>=<span style="color: #CC9393;">"5"</span> <span style="color: #DFAF8F;">nom</span>=<span style="color: #CC9393;">"E10"</span> <span style="color: #DFAF8F;">debut</span>=<span style="color: #CC9393;">"2017-09-07T11:05:59"</span> <span style="color: #DFAF8F;">fin</span>=<span style="color: #CC9393;">""</span>/&gt;
  &lt;/<span style="color: #93E0E3;">pdv</span>&gt;
&lt;/<span style="color: #93E0E3;">pdv_liste</span>&gt;
</pre>
</div>
<ul class="org-ul">
<li>Un document XML est composé de noeuds définis sous la forme de balise <code>&lt;nom_du_noeud&gt; ... contenu
  ... &lt;/nom_du_noeud&gt;</code> ou <code>&lt;nom_du_noeud/&gt;</code> si ce dernier ne possède pas de contenu.</li>
<li>Le contenu d'un noeud peut être du texte (ou des valeurs numériques qui seront interprétées comme
du texte) ou d'autres noeuds.</li>
<li>Un noeud peut également avoir des attributs définis sous la forme de clés/valeurs placés au niveau
de la balise d'ouverture du noeud.</li>
<li>Exemple : le noeud <code>&lt;prix nom="Gazole" id="1" maj="2021-11-18T15:00:57" valeur="1527"/&gt;</code> possèdent
4 attributs <code>nom</code>, <code>id</code>, <code>maj</code> et <code>valeur</code> mais ne possède pas de contenu.</li>
</ul>



<p>
<b>Traitements <code>Python</code> :</b>
</p>
<ul class="org-ul">
<li>Utilisation du module <code>lxml</code> (<code>!pip install lxml</code>).</li>
<li>La lecture des données est réalisée sous la forme d'un parcours du document (on parle de
<i>parsing</i>) en suivant sa
structure hiérarchique arborescente (objet <a href="https://lxml.de/tutorial.html"><code>etree</code></a>).</li>
<li>En général, on ne cherche pas à stocker entièrement le contenu du fichier XML dans une structure
<code>Python</code>.</li>
<li>La démarche usuelle consiste à extraire du document uniquement les informations importantes afin
de les traiter ultérieurement <i>via</i> des structures <code>Python</code> classiques (dictionnaires, DataFrames,
etc).</li>
<li>La recherche des données pertinentes dans la structure XML peut s'effectuer avec la méthode
<a href="https://python.doctor/page-xml-python-xpath"><code>.xpath</code></a>. À noter que XPath (<i>XML Path Language</i>) est un langage de requête permettant d'extraire
des éléments d'un document XML. Ce langage peut paraître relativement complexe au premier abord
mais s'avère extrêment pratique pour traiter les grands documents XML.</li>
</ul>

<p>
<b>Exemple :</b>
</p>
<ul class="org-ul">
<li>Télécharger le fichier <a href="https://roland-donat.github.io/ubs-lpsdm-qualite-donnees/2021-2022/datatype/data/prix_carburant.xml">prix_carburant.xml</a> sur votre poste
(<a href="https://www.data.gouv.fr/fr/datasets/prix-des-carburants-en-france/">Source : data.gouv.fr</a>).</li>
<li>Importer le fichier par glisser-déposer dans votre environnement Deepnote.</li>
<li>Objectif : calculer le prix moyen du gazole.</li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">from</span> lxml <span style="color: #F0DFAF; font-weight: bold;">import</span> etree
<span style="color: #F0DFAF; font-weight: bold;">import</span> pandas <span style="color: #F0DFAF; font-weight: bold;">as</span> pd

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Lecture du fichier XML dans un objet etree</span>
<span style="color: #DFAF8F;">data_xml_path</span> = <span style="color: #CC9393;">"prix_carburant.xml"</span>
<span style="color: #DFAF8F;">data_tree</span> = etree.parse(data_xml_path)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">R&#233;cup&#233;ration des noeuds prix ayant leur attribut nom="Gazole"</span>
<span style="color: #DFAF8F;">prix_elt_list</span> = data_tree.xpath(<span style="color: #CC9393;">'//prix[@nom="Gazole"]'</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Parcours des noeuds prix afin d'en extraire les attributs valeur</span>
<span style="color: #DFAF8F;">prix_gazole</span> = []
<span style="color: #F0DFAF; font-weight: bold;">for</span> prix_elt <span style="color: #F0DFAF; font-weight: bold;">in</span> prix_elt_list:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   prix_gazole.append(prix_elt.xpath(<span style="color: #CC9393;">'@valeur'</span>)[0])

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Conversion de la liste de valeurs en Series Pandas pour faciliter les traitements</span>
<span style="color: #DFAF8F;">prix_gazole_s</span> = pd.Series(prix_gazole).astype(<span style="color: #DCDCCC; font-weight: bold;">int</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Calcul du prix moyen du gazole :</span>
<span style="color: #F0DFAF; font-weight: bold;">print</span>(f<span style="color: #CC9393;">"Prix moyen du gazole = {prix_gazole_s.mean()/1000:.4} &#8364;"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8bde166" class="outline-2">
<h2 id="org8bde166"><span class="section-number-2">7</span> <i>Web scraping</i></h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org88a4883" class="outline-3">
<h3 id="org88a4883"><span class="section-number-3">7.1</span> Définition</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Le <i>web scraping</i> est l'art d'extraire des données depuis un site web. Cette technique permet de
récupérer des informations depuis site grâce à un logiciel et de les réutiliser ensuite.
</p>

<p>
En pratique, le logiciel de scraping va parcourir les pages web cibles et tenter de
tirer parti de la structure de leur code HTML afin de localiser les informations pertinentes.
</p>

<p>
Le <i>web scraping</i> est particulièrement utile dans le cadre de la prospection
ou de la veille concurrentielle d'une entreprise. On peut ainsi récolter les données d'un site concurrent
pour surveiller ses variations de prix ou bien l'évolution de ses offres. Cela permet également de
récupérer des retours clients et de réaliser des traitements statistiques sur ces derniers.
</p>

<p>
<b>À noter que le <i>web scraping</i> n'a d'intérêt que si le site ciblé ne possède pas d'API permettant
d'accéder facilement aux données recherchées.</b> 
</p>
</div>
</div>

<div id="outline-container-orgfa213e9" class="outline-3">
<h3 id="orgfa213e9"><span class="section-number-3">7.2</span> Technique de <i>scraping</i> avec <code>Python</code></h3>
<div class="outline-text-3" id="text-7-2">
<p>
Les principales librairies <code>Python</code> permettant de faire du <i>web scraping</i> sont les suivantes :
</p>
<ul class="org-ul">
<li><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/"><code>Beautiful Soup</code></a> : Librairie de référence pour le <i>web scraping</i>. <code>Beautiful Soup</code> permet
d'explorer le contenu des pages web bien structurées ou non.</li>
<li><a href="https://lxml.de/"><code>lxml</code></a> : Librairie conçu initialement pour l'exploration des fichiers XML fonctionne également
très bien avec les documents HTML bien structurés. En revanche, pour les pages HTML mal conçues,
<code>lxml</code> n'est pas l'outil approprié.</li>
<li><a href="https://docs.scrapy.org/en/latest/intro/tutorial.html"><code>scrapy</code></a> : Librairie proposant un ensemble d'outils de <i>web scraping</i> avancés. <code>scrapy</code> est
probablement l'outil <code>Python</code> de <i>web scraping</i> le plus puissant en termes de fonctionnalités et
de performances. Toutefois, <code>scrapy</code> est plus complexe à prendre en main que <code>Beautiful Soup</code> et
<code>lxml</code> et s'adresse plutôt à des utilisateurs expérimentés.</li>
</ul>
</div>
</div>

<div id="outline-container-org06b8056" class="outline-3">
<h3 id="org06b8056"><span class="section-number-3">7.3</span> Exemple</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Dans cet exemple, nous allons tenter d'extraire automatiquement les sujets postés sur le forum Morbihan du site du
Routard : <a href="https://www.routard.com/forum_voyage/1511_morbihan_bretagne/60.htm">https://www.routard.com/forum_voyage/1511_morbihan_bretagne/60.htm</a>.
</p>

<p>
Pour ce faire, nous utiliserons la librairie Beautiful Soup (<code>!pip install
beautifulsoup4</code>). L'objectif final est de construire un DataFrame contenant les titres des sujets
postés dans le forum avec leur auteur et la date du dernier message.
</p>

<p>
Les grandes étapes du traitement sont les suivantes :
</p>
<ol class="org-ol">
<li>Ouvrir la page web cible et analyser rapidement son code source afin de repérer où se situent les
informations recherchées.</li>
<li>Lire la page web avec Beautiful Soup.</li>
<li>Extraire une liste d'éléments contenant les informations recherchées.</li>
<li>En considérant uniquement le premier élément de la liste précédente, extraire le sujet, l'auteur
et la date.</li>
<li>Automatiser le processus pour récupérer toutes les informations souhaitées.</li>
<li>Stocker le résultat final dans un DataFrame.</li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Import des modules</span>
<span style="color: #F0DFAF; font-weight: bold;">import</span> pandas <span style="color: #F0DFAF; font-weight: bold;">as</span> pd
<span style="color: #F0DFAF; font-weight: bold;">import</span> requests
<span style="color: #F0DFAF; font-weight: bold;">from</span> bs4 <span style="color: #F0DFAF; font-weight: bold;">import</span> BeautifulSoup

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Lecture de la page web</span>
<span style="color: #DFAF8F;">url</span> = <span style="color: #CC9393;">"https://www.routard.com/forum_voyage/1511_morbihan_bretagne/60.htm"</span>
<span style="color: #DFAF8F;">html_text</span> = requests.get(url).text
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">L'objet soup contient une repr&#233;sentation structur&#233;e de la page web. </span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Nous allons donc pouvoir effectuer des requ&#234;tes sur cet objet afin </span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">d'extraire les informations souhait&#233;es.</span>
<span style="color: #DFAF8F;">soup</span> = BeautifulSoup(html_text, <span style="color: #CC9393;">'html.parser'</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Recheche de tous les &#233;l&#233;ments HTML ayant un attribut itemtype="http://schema.org/Article"</span>
<span style="color: #DFAF8F;">sujet_soup_list</span> = soup.find_all(itemtype=<span style="color: #CC9393;">"http://schema.org/Article"</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Analyse du premier &#233;l&#233;ment afin d'extraire les informations souhait&#233;es</span>
<span style="color: #DFAF8F;">sujet_soup</span> = sujet_soup_list[0]
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Extraction du titre</span>
sujet_soup.find(itemprop=<span style="color: #CC9393;">"name"</span>).getText()
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Extraction de l'auteur</span>
sujet_soup.find(itemprop=<span style="color: #CC9393;">"author"</span>).getText()
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Extraction de la date du dernier message</span>
sujet_soup.find(<span style="color: #CC9393;">"time"</span>).get(<span style="color: #CC9393;">"datetime"</span>)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Automatisation du processus</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Liste qui contiendra les donn&#233;es extraites</span>
<span style="color: #DFAF8F;">data</span> = []
<span style="color: #F0DFAF; font-weight: bold;">for</span> sujet_soup <span style="color: #F0DFAF; font-weight: bold;">in</span> sujet_soup_list:
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">R&#233;cup&#233;ration du titre</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">titre_elt</span> = sujet_soup.find(itemprop=<span style="color: #CC9393;">"name"</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Note: on v&#233;rifie que l'information est pr&#233;sente sinon on stocke la cha&#238;ne vide</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">titre</span> = titre_elt.getText() <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #F0DFAF; font-weight: bold;">not</span>(titre_elt <span style="color: #F0DFAF; font-weight: bold;">is</span> <span style="color: #BFEBBF;">None</span>) <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #CC9393;">""</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">R&#233;cup&#233;ration de l'auteur</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">auteur_elt</span> = sujet_soup.find(itemprop=<span style="color: #CC9393;">"author"</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">auteur</span> = auteur_elt.getText() <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #F0DFAF; font-weight: bold;">not</span>(auteur_elt <span style="color: #F0DFAF; font-weight: bold;">is</span> <span style="color: #BFEBBF;">None</span>) <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #CC9393;">""</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">R&#233;cup&#233;ration de la date</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">date_msg_elt</span> = sujet_soup.find(<span style="color: #CC9393;">"time"</span>)
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">date_msg</span> = date_msg_elt[<span style="color: #CC9393;">"datetime"</span>] <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #F0DFAF; font-weight: bold;">not</span>(date_msg_elt <span style="color: #F0DFAF; font-weight: bold;">is</span> <span style="color: #BFEBBF;">None</span>) <span style="color: #F0DFAF; font-weight: bold;">else</span> <span style="color: #CC9393;">""</span>

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Stockage des informations dans un dictionnaire</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #DFAF8F;">data_sujet</span> = <span style="color: #DCDCCC; font-weight: bold;">dict</span>(titre=titre, auteur=auteur, date_msg=date_msg)

<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Ajout du dictionnaire dans la liste de donn&#233;es</span>
<span style="color: #DCDCCC; background-color: #4F4F4F;"> </span>   data.append(data_sujet)

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Cr&#233;ation d'un DataFrame contenant les donn&#233;es extraites</span>
<span style="color: #DFAF8F;">data_df</span> = pd.DataFrame(data)
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
